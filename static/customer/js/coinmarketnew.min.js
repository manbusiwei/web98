var priceTmp={btc:[],eth:[],favorite:[]};function get_data(){$.each(allMarkets,function(a,t){getMarketData(a)}),USER&&$.get(WebHelper.queryOptionalRealTimeMap,function(a){1==a.status&&(priceTmp.favorite=a.data.data,sortBy&&priceTmp.favorite.sort(sortcoinList(sort_hTol,sortBy)),renderPage(priceTmp.favorite,"favorite"))})}function getMarketData(t){$.get(WebHelper.QueryRealTimeMap+"?coinType="+t+"&t="+Math.random(),function(a){1==a.status?(priceTmp[allMarkets[t]]=a.data.data,a.data.coin&&1==t&&$(".btcPrice").html(a.data.coin[getLang_rate()+"Para"]),sortBy&&priceTmp[allMarkets[t]].sort(sortcoinList(sort_hTol,sortBy)),renderPage(priceTmp[allMarkets[t]],t)):console.log("首页列表操作失败type="+t)})}function renderPage(a,t){var e="",i=JSON.parse(localStorage.getItem("favorite")||"{}"),r=0;$.each(i,function(a,t){r+=Object.getOwnPropertyNames(t).length});for(var o=0;o<a.length;o++){var s=a[o].name.toLowerCase(),n=a[o].coinType||t,c=allMarkets[n],l=a[o].id,d=0==parseFloat(a[o].increase)?"":parseFloat(a[o].increase)<0?"red":"green",p=0<parseFloat(a[o].increase)?"+":"",m=1==a[o].isOptional?"active":!USER&&i[c]&&i[c][s]==l?"active":"";if(e+='<li data-favoritecoin="'+l+'" data-favoriteCoinName="'+s+'"><dl style="zoom:1" class="autobox clear"><dt style="width:180px"><span class="'+(1==a[o].isNew?"isNewCoin":"")+'"></span><i data-coinType="'+n+'" class="isFavorite '+m+'" data-coinId="'+a[o].id+'" data-coinName="'+s+'" data-trends="'+a[o].trends.join("__")+'"></i><em class="coin coin_30 coin_'+s+'_30"></em><p>'+a[o].name.toUpperCase()+"/"+c.toUpperCase()+'<br/><span class="coinName">'+a[o].name1+'</span></p></dt><a data-coinType="'+n+'" href="/trade/coinTrade.html?id='+a[o].id+"&shortName="+s+"&coinType="+n+'"><dd class="is_num '+d+'" data-point="'+a[o].decimalDigits+'">'+a[o].LatestDealPrize+'</dd><dd style="width:130px" class="is_num '+d+'" data-point="'+a[o].decimalDigits+'">'+(0<a[o][getLang_rate()]&&a[o][getLang_rate()]<1?a[o][getLang_rate()].toPrecision(2):a[o][getLang_rate()].toFixed(2))+'</dd><dd style="width:135px" class="'+d+'">'+p+a[o].increase+'%</dd><dd class="is_num" data-point="'+a[o].decimalDigits+'">'+a[o].OneDayHighest+'</dd><dd class="is_num" data-point="'+a[o].decimalDigits+'">'+a[o].OneDayLowest+'</dd><dd style="width:130px" class="is_num" data-point="'+a[o].decimalNum+'">'+parseFloat(a[o].OneDayTotalNum)+'</dd><dd style="width:160px; height: 46px;position: relative;" class="'+a[o].name+"_plot_"+a[o].id+'"> </dd><div class="clear"></div></dl></a></li>',!USER&&"favorite"!=t&&i[c]&&i[allMarkets[n]][s]==l){var f=!0;$.each(priceTmp.favorite,function(a,t){if(t.id==l)return f=!1}),f&&(priceTmp.favorite.length<r&&priceTmp.favorite.push(a[o]),priceTmp.favorite.length==r&&renderPage(priceTmp.favorite,"favorite"))}}"favorite"==t?$(".show_favorite_data").html(e):($(".show_"+(allMarkets[t]?allMarkets[t]:t).toUpperCase()+"_data").html(e),1==t&&$("#docLoading").hide()),goods_num(),allcoin_callback(a,t)}function allcoin_callback(a){for(var t in a)for(var e=$("."+a[t].name+"_plot_"+a[t].id),i=0;i<e.length;i++)$.plot(e.eq(i),[{shadowSize:0,data:a[t].trends}],{grid:{borderWidth:0},xaxis:{mode:"time",ticks:!1},yaxis:{tickDecimals:0,ticks:!1},colors:["#ff5818"]})}function favDrawPlot(a){for(var t=a.coinname.toUpperCase(),e=[],i=a.trends.split("__"),r=0;r<i.length;r++)e.push(i[r].split(","));$.plot($("."+t+"_plot_"+a.coinid),[{shadowSize:0,data:e}],{grid:{borderWidth:0},xaxis:{mode:"time",ticks:!1},yaxis:{tickDecimals:0,ticks:!1},colors:["#ff5818"]})}function sortcoinList(a,t){return new Function("a","b",'return parseFloat(a["'+t+'"])'+(1==a?">":"<")+'parseFloat(b["'+t+'"])? 1:-1')}function rd(){return Math.random()}setInterval(function(){get_data()},15e3);var sort_hTol=0,sortBy="";function sortCoinHtml(){for(var a in priceTmp){var t="";if("favorite"==a)t=a;else for(var e in allMarkets)allMarkets[e]==a&&(t=e);priceTmp[a].sort(sortcoinList(sort_hTol,sortBy)),renderPage(priceTmp[a],t)}}$(function(){get_data(),$(".price_today_ull > .click-sort").each(function(){$(this).click(function(){0==$(this).find(".active").length?$(this).find(".cagret-up").addClass("active"):$(this).find(".cagret").toggleClass("active"),sort_hTol=0==sort_hTol?1:0,(sortBy=$(this).data("sort"))&&sortCoinHtml()})})});