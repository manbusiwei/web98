var priceTmp={btc:[],eth:[],favorite:[]},isAllFavoriteData=0,favoriteHtml="";function get_data(){$.each(allMarkets,function(t,a){getMarketData(t)}),USER&&$.get(WebHelper.queryOptionalRealTime,function(t){1==t.status?(priceTmp.favorite=t.data,renderPage(priceTmp.favorite,"favorite")):(favoriteHtml="",priceTmp.favorite=[],isAllFavoriteData=0)})}function getMarketData(a){$.get(WebHelper.queryRealTime+"?coinType="+a+"&t="+Math.random(),function(t){1==t.status?(priceTmp[allMarkets[a]]=t.data,renderPage(priceTmp[allMarkets[a]],a)):console.log("交易页列表操作失败,类型:"+a)})}function renderPage(t,a){isAllFavoriteData+=1;var e="",r=JSON.parse(localStorage.getItem("favorite")||"{}");r[allMarkets[a]]||(r[allMarkets[a]]={},localStorage.setItem("favorite",JSON.stringify(r)));var i=0;$.each(r,function(t,a){i+=Object.getOwnPropertyNames(a).length});for(var o=0;o<t.length;o++){var l=t[o].C||a,s=allMarkets[l],n=t[o].N.toLowerCase(),c=t[o].ID,p=0==parseFloat(t[o].I)?"":parseFloat(t[o].I)<0?"red":"green",d=0<parseFloat(t[o].I)?"+":"",f=1==t[o].O?"active":USER||r[allMarkets[l]][n]!=c?"":"active";if(e+='<li data-favoritecoin="'+c+'"><i data-coinType="'+l+'" class="isFavorite '+f+'" data-coinId="'+c+'" data-coinName="'+n+'"></i><dl style="zoom:1" class="autobox clear"><a data-coinType="'+l+'" href="/trade/coinTrade.html?id='+c+"&shortName="+n+"&coinType="+l+'"><dt><p>'+n.toUpperCase()+"/"+s.toUpperCase()+'</p></dt><dd class="is_num '+p+'" data-point="'+t[o].DD+'">'+t[o].LDP+'</dd><dd style="width:60px;text-align:right;padding-right:5px" class="'+p+'">'+d+t[o].I+'%</dd><div class="clear"></div></a></dl></li>',!USER&&"favorite"!=a&&r[s]&&r[allMarkets[l]][n]==c){var v=!0;$.each(priceTmp.favorite,function(t,a){if(a.ID==c)return v=!1}),v&&(priceTmp.favorite.length<i&&priceTmp.favorite.push(t[o]),priceTmp.favorite.length==i&&renderPage(priceTmp.favorite,"favorite"))}}"favorite"==a?$(".show_favorite_data").html(e):$(".show_"+(allMarkets[a]?allMarkets[a]:a).toUpperCase()+"_data").html(e),goods_num()}function sortcoinList(t,a){return new Function("a","b",'return parseFloat(a["'+a+'"])'+(1==t?">":"<")+'parseFloat(b["'+a+'"])? 1:-1')}function rd(){return Math.random()}setInterval(function(){get_data()},1e5);var sort_hTol=0,sortBy="";$(function(){get_data(),$(".price_today_ull > .click-sort").each(function(){$(this).click(function(){if(0==$(this).find(".active").length?$(this).find(".cagret-up").addClass("active"):$(this).find(".cagret").toggleClass("active"),sort_hTol=0==sort_hTol?1:0,sortBy=$(this).data("sort"))for(var t in priceTmp){for(var a in allMarkets)allMarkets[a]==t&&a;priceTmp[t].sort(sortcoinList(sort_hTol,sortBy))}})})});